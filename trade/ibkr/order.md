# 条件单
要在价格突破阻力位之前和之后使用两种不同的 Trailing Stop 百分比，你需要动态地调整你的 Trailing Stop 策略。这通常涉及到对市场条件和价格行为的实时监控，并在特定条件满足时手动或自动调整 Trailing Stop 的设置。以下是操作步骤：

### 1. 定义阻力位和两种 Trailing Stop 百分比
- 确定阻力位：通过技术分析确定一个关键的阻力位。
- 设定两种不同的 Trailing Stop 百分比：
  - **价格未突破阻力前**：设定一个较高的 Trailing Stop 百分比，以提供更大的价格波动空间。
  - **价格突破阻力后**：设定一个较低的 Trailing Stop 百分比，以更紧密地跟踪价格并保护盈利。

### 2. 监控市场价格
- 使用实时价格跟踪系统来监控股票价格是否突破了阻力位。

### 3. 手动或自动调整 Trailing Stop
- **手动调整**：一旦价格突破阻力位，手动更改你的 Trailing Stop 设置为较低的百分比。
- **自动调整**：如果你有能力编写或使用高级交易软件，可以设置自动化规则。这些规则在检测到价格突破阻力位时自动调整 Trailing Stop 的百分比。

### 4. 使用条件单
- 在某些交易平台上，你可能能够设置条件单（conditional orders），其中 Trailing Stop 的调整会在满足特定条件（如价格突破阻力位）时自动发生。

### 5. 持续监控和调整
- 由于市场条件可能发生变化，持续监控你的策略并在必要时进行调整。

### 注意事项
- **实时监控**：这种策略需要对市场价格的实时监控。
- **风险管理**：在调整 Trailing Stop 设置时，始终考虑到整体风险管理策略。
- **交易平台限制**：检查你的交易平台是否支持这种类型的动态调整和/或条件单。

通过上述步骤，你可以根据市场条件的变化，灵活地调整 Trailing Stop 策略，以适应价格突破阻力位之前后的不同市场情况。



# "Time in Force"（有效期限）
是指一个订单在被取消之前将持续有效的时间长度。根据订单类型、交易所和产品的不同，有多种有效期限可供选择。不同的有效期限适用于不同的交易策略和市场条件。

### 主要的有效期限类型
1. **Day（日内）**：
   - 订单在当天的常规交易时间内有效，如果未成交，则在交易日结束时取消。
   - 适用于短期交易策略，尤其是当天可能发生的价格波动。

2. **GTC (Good-Til-Canceled，有效直至取消)**：
   - 订单将持续有效，直到执行或用户取消。
   - 适用于长期投资策略，或当你没有特定的时间限制但有具体价格目标时。

3. **OPG (Opening Price, 开盘价)**：
   - 用于发送开盘市价单（MOO）或开盘限价单（LOO）。
   - 适用于希望在开盘时即刻执行交易的策略。

4. **IOC (Immediate-or-Cancel, 立即成交或取消)**：
   - 订单要么立即成交，未成交部分则立即取消。
   - 适用于快速交易，需要迅速确认的情况。

5. **GTD (Good-Til-Date, 有效直至指定日期)**：
   - 订单在指定日期的市场关闭时前有效。
   - 适用于有明确退出计划的交易策略。

6. **FOK (Fill-or-Kill, 全数成交或取消)**：
   - 如果订单不能立即完全成交，那么整个订单将被取消。
   - 适用于大宗交易，需要一次性完成的情况。

7. **DTC (Day 'Til Canceled, 日内直至取消)**：
   - 类似于日内订单，但在当天结束时不是被取消，而是被停用。可以随时重新提交。
   - 适用于可能需要在一天内多次激活的策略。

8. **Fill/Trigger Outside RTH (Fill/Trigger outside Regular Trading Hours, 常规交易时间外成交/触发)**：
   - 允许订单在常规交易时间以外成交或触发。
   - 适用于跨越常规交易时段的交易策略。

### 总结
选择合适的“有效期限”对于实施有效的交易策略至关重要。它可以帮助投资者更好地控制订单的执行时间和条件，以适应不同的市场情况和个人投资目标。不同的有效期限适用于不同的交易环境和策略，因此选择与您的交易目标和市场情况相匹配的有效期限非常重要。

# Trailing amount & percentage for the traling stop

在 "Stop Trailing Limit" 订单中，计算跟踪金额（Trailing Amount）或百分比（Trailing Percentage）的方法是基于投资者对市场波动性的理解和风险容忍度。这个值决定了止损价格与市场价格之间的动态距离。

### 计算方法
1. **跟踪金额（Trailing Amount）**：这是一个固定的价差，用于设定止损价格与市场价格之间的距离。例如，如果您设置了$1的跟踪金额，那么止损价格将始终保持在市场价格下方$1的位置。
2. **跟踪百分比（Trailing Percentage）**：这是一个百分比，用于按市场价格的百分比确定止损价和市场价格之间的距离。例如，如果设置了2%的跟踪百分比，止损价格将保持在市场价格下方2%的位置。

### 选择跟踪金额或百分比的指标
没有直接的指标可以用来确定最佳的跟踪金额或百分比，因为它们依赖于多个因素，包括个人投资策略、资产波动性和市场条件。然而，一些常用的方法和指标包括：

1. **历史波动性**：考察资产过去的价格波动，以此来估计合理的跟踪金额或百分比。使用像标准差或平均真实范围（ATR）这样的波动性指标可以帮助确定这个数值。
2. **支撑/阻力水平**：分析技术图表中的支撑和阻力水平，以设置止损价格，确保止损点不会因市场的正常波动而过早触发。
3. **资产的平均交易范围**：考察资产的日内或近期的平均交易范围，以确定合适的跟踪金额或百分比。
4. **风险容忍度**：根据个人的风险承受能力和投资目标来调整跟踪金额或百分比。

### 为什么没有直接的指标
由于市场条件的不断变化和个人投资策略的多样性，没有单一的指标能够适用于所有情况。投资者需要根据自己对市场的理解、风险偏好和投资目标来决定合适的跟踪金额或百分比。这需要一定的市场分析技能和对自己投资策略的深入理解。


平均真实范围（Average True Range, ATR）是一种衡量市场波动性的技术分析工具。它通常用于设置止损订单（如 Trailing Stop）的跟踪金额或百分比。

### ATR的定义
ATR 计算了一段时间内每日价格波动的平均值。它考虑以下三个价格范围的最大值，并对这个最大值进行平均：
1. **当日最高价与最低价之间的范围**。
2. **当日最高价与前一日收盘价之间的范围**。
3. **当日最低价与前一日收盘价之间的范围**。

通常，ATR 是在一定天数（常用14天）内计算得出的平均值。

### 使用ATR来计算 Trailing Percent
ATR 可以作为确定 Trailing Stop 百分比的参考。方法如下：

1. **计算ATR**：首先，计算过去一定天数（如14天）的ATR值。
2. **决定ATR乘数**：接着，决定一个ATR乘数，这取决于你的风险容忍度。例如，一些交易者可能使用1倍ATR，而风险承受能力更高的交易者可能使用2倍或3倍ATR。
3. **计算Trailing Stop 百分比**：将ATR乘数乘以ATR值，然后除以当前的市场价格，得出的结果是 Trailing Stop 的百分比。例如，如果ATR是$1，当前股价是$50，而你使用2倍ATR，那么 Trailing Percent = (2 * $1) / $50 = 0.04，即4%。

### 优点和局限性
使用ATR 设置 Trailing Stop 百分比的优点在于能够考虑到资产的历史波动性，从而更好地适应市场条件。然而，也要注意其局限性：
- ATR 是基于过去的数据，可能不会完全预测未来的市场波动性。
- ATR 不考虑市场方向，只反映价格波动的幅度。
- 设置的乘数和天数可能需要根据不同的市场环境和交易策略进行调整。

因此，虽然ATR可以提供有用的指导，但在使用它来确定 Trailing Stop 百分比时，仍需考虑当前的市场状况和个人的交易策略。


# Trailing Stop

"Trailing Stop" 订单是一种动态的止损策略，用于管理投资风险，同时保持对可能盈利的开放性。这种订单的特点是其止损价格会随着市场价格的变动而调整，但只在有利的方向上移动。

### 工作原理
- **卖出 Trailing Stop（Sell Trailing Stop）**：设定一个止损价格，该价格位于市场价格下方一个固定的距离（即跟踪金额）。如果市场价格上升，止损价格也会按照设定的跟踪金额上升，保持固定的间隔。如果市场价格下降，止损价格则保持不变。当市场价格触及止损价格时，会自动提交一个市价单。
- **买入 Trailing Stop（Buy Trailing Stop）**：与卖出 Trailing Stop 相反，止损价格设在市场价格上方一个固定的跟踪金额，随市场价格下降而下降，但在市场价格上升时保持不变。

### 使用场景
- **管理风险**：Trailing Stop 订单允许投资者设定最大可能损失的上限，同时不限制可能的最大盈利。
- **适应市场波动**：在波动的市场中，Trailing Stop 订单能够自动适应价格变动，避免由于市场突然变动而过早退出持仓。

### 举例
假设您购买了一只股票，当前价格为 $100。您设置一个卖出 Trailing Stop 订单，跟踪金额为 $5。这意味着如果股票价格上升到 $105，止损价格会上升到 $100。如果股票价格继续上升至 $110，止损价格会相应上升至 $105。但如果股票价格开始下降，止损价格将保持在 $105。一旦股票价格跌至 $105 或以下，将触发市价卖出。

### 总结
Trailing Stop 订单是一种有效的风险管理工具，尤其适用于波动的市场环境。它提供了一种灵活的方式来保护盈利，同时限制损失。通过自动调整止损价格，Trailing Stop 订单能够帮助投资者更好地适应市场变动，同时保持对潜在盈利的开放性。

"Trailing Stop Limit" 订单是一种结合了动态跟踪止损和限价单的交易指令。它允许投资者设定一个随市场价格动态变化的止损价，并且当触发止损时，而不是提交市价单，而是提交一个限价单。这种订单类型旨在帮助投资者限制最大可能损失，同时不限制最大可能盈利。

### 四个关键组成部分
1. **止损价（Stop Price）**：当市场价格达到此价位时触发订单。
2. **跟踪金额（Trail Amount）**：止损价与市场价格之间的固定差额。
3. **限价（Limit Price）**：提交的限价单的价格。
4. **限价偏移量（Limit Offset）**：用于计算限价与止损价之间差额的偏移量。

### 工作原理
- 当市场价格上升时，止损价和限价根据跟踪金额和限价偏移量相应地上升，但如果市场价格下降，止损价保持不变。
- 一旦触达止损价，不是像普通的 Trailing Stop 那样提交市价单，而是以最后计算的限价提交限价单。

### 使用场景
- **在波动的市场中管理风险**：当市场价格上升时，止损价和限价随之上升，从而保护未实现的盈利，同时限制潜在的损失。
- **在确定的价格点出场**：当止损价被触发时，Trailing Stop Limit 订单允许投资者以预设的限价出售或购买股票，而不是以当前市场价格。

### 举例
假设您持有一支股票，当前价格为 $100，您设置一个 Trailing Stop Limit 卖单，跟踪金额设为 $5，限价偏移量设为 $1。
- 当股票价格上升到 $105，止损价会上升到 $100，如果价格继续上升至 $110，止损价会上升至 $105。
- 如果股票价格开始下降，止损价保持在 $105。一旦股票价格跌至 $105，将以 $104（$105 偏移 $1）的限价提交卖单。

### 总结
Trailing Stop Limit 订单是一种结合了止损和限价功能的动态订单，它提供了在市场波动时保护盈利和限制损失的灵活性。与普通的 Trailing Stop 订单不同，它在止损触发时提交的是限价单，而不是市价单，这为投资者提供了更精确的价格控制。


# Pegged
让我们一一探讨这些订单类型及其适用场景：

1. **Pegged-to-Midpoint Orders（中点挂钩订单）**：
   - **场景**：当交易者希望在国家最优买卖报价（NBBO）的中间价位获得价格改善时使用。这种订单类型特别适合那些寻求在市场买卖价差中间进行交易的投资者，因为订单价格会自动调整以跟踪市场波动。
   - **优势**：能够在市场价格变动时自动调整，有助于捕捉更有利的交易机会。

2. **IBKR ATS Pegged-to-Best（最佳挂钩订单）**：
   - **场景**：适用于希望快速成交的交易者。通过将卖单价格设定为比最佳买价高一点点，买单价格设定为比最佳卖价低一点点，这种订单类型提高了与进入市场的新订单成交的可能性。
   - **优势**：通过微小的价格调整，增加了交易快速成交的机率，特别适用于快速变动的市场环境。

3. **IBKR ATS Pegged-to-Midpoint（带可选偏移的中点挂钩订单）**：
   - **场景**：适用于希望在NBBO的中点价格获得交易机会，同时通过可选的偏移量来增加成交的可能性的交易者。这种类型的订单允许在市场条件变化时灵活调整偏移量，以提高在特定价格点的交易机会。
   - **优势**：提供了额外的灵活性，使投资者能够根据市场状况和个人策略调整其订单的价格。

这些订单类型提供了不同程度的价格控制和市场适应性，对于不同的交易策略和市场条件具有不同的优势。选择适当的订单类型可以帮助投资者更有效地实现其交易目标。

# Limit if Touched
确实，从表面上看，"Limit if Touched"（LIT）订单和普通的限价单（limit order）在实际执行上似乎相似，因为它们都是在达到某个特定价格时才会执行。然而，关键的区别在于触发条件和订单激活的时机，这影响了它们的应用场景和策略适用性。

1. **订单激活的时机**：
   - **普通限价单**：在市场中始终是活跃的。这意味着，一旦市场价格达到或优于限价，订单就会尝试执行。这在快速波动的市场中可能导致意料之外的执行，特别是在价格波动较大时。
   - **LIT订单**：只有当市场价格触及或穿过设定的触发价格时，才会变为活跃的限价单。这种“等待触发”的特性使LIT订单在某些策略中更有优势，尤其是在预测价格会先达到一个特定点然后再发生重要变化的情况下。

2. **对市场趋势的预测**：
   - 普通限价单更多用于“当前价格已经是我愿意交易的价格”的情况。
   - LIT订单则通常用于“我预计市场价格会达到一个特定点，然后发生我期待的价格变化”的策略。比如，预测股价会下跌到某一点然后反弹，或者上涨到某一点然后回调。

3. **风险控制**：
   - LIT订单通过延迟订单的激活，提供了一种风险控制机制，因为它们只有在触发价格被触及时才会变成活跃的限价单。这可以防止在价格波动较大的市场中过早或不必要的执行。

4. **策略的实现**：
   - 对于那些基于价格行为或技术指标设定交易点的策略，LIT订单提供了一种确保只在某些特定条件满足时才参与市场的方式。例如，在突破交易中，投资者可能希望在价格突破重要阻力位后才进行买入，而LIT订单则可以在这种情况下更有效地实施策略。

总的来说，尽管在某些情况下LIT订单和普通限价单的效果可能相似，但LIT订单提供了更多的控制和策略实施灵活性，尤其是在涉及市场价格达到特定点然后预期发生变化的交易策略中。

# 适应性算法（Adaptive Algo）
与普通限价单（limit order）相比具有几个显著优势：

1. **价格改善的可能性更高**：适应性算法在买卖价差内寻找最佳交易机会，这可能导致比简单的限价单更好的成交价格。

2. **灵活的交易速度控制**：用户可以根据市场状况和自己的需求选择不同的填充优先级，从“紧急”到“耐心”。这种灵活性允许投资者更精确地控制他们的订单执行策略，根据市场条件调整交易速度。

3. **更有效的市场适应性**：适应性算法能够根据市场流动性和价格波动动态调整，提高在不同市场条件下的交易效率。

4. **减少价格滑点（Slippage）的风险**：在高波动性市场中，限价单可能无法以期望的价格成交，而适应性算法通过在买卖价差内寻找交易机会，减少了价格滑点的风险。

5. **更好的隐藏性**：对于大额交易，适应性算法有助于更好地隐藏交易意图，防止市场对大单产生过激反应，从而保护投资者的利益。

总之，适应性算法在提供价格改善机会、减少价格滑点风险、以及提高交易灵活性和效率方面，相比于传统的限价单具有明显优势，特别适合在快速变化和复杂的市场环境中使用。

# "Passive Relative" 订单
- Improve chance
"Passive Relative" 订单是一种特殊的限价单，它的价格设置在国家最优买卖报价（NBBO）的基础上，通过一个不太激进的偏移量来自动调整。这种订单类型适用于希望在市场价格基础上稍作调整以提高成交机会，同时又不希望过分激进地进入市场的投资者。

### 使用场景
1. **市场价格波动时保持竞争力**：当市场价格波动时，Passive Relative 订单能够自动调整其价格，保持与市场同步，但又不会过于激进。
2. **寻求比NBBO更有利的价格**：对于希望在NBBO的基础上寻找更好交易机会的交易者，此订单类型可以提供额外的价格优势。

### Offset 的使用
- **买单（Buy Order）**：偏移量从最佳买价（best bid）中减去。如果最佳买价（NBB）上升，您的买价也会相应上升。
- **卖单（Sell Order）**：偏移量加到最佳卖价（best ask）上。如果最佳卖价（NBO）下降，您的卖价也会相应下降。

### 成交价与Bid/Ask的关系
- **买单**：成交价通常会小于或等于最佳卖价（best ask），因为偏移量是减去的。
- **卖单**：成交价通常会大于或等于最佳买价（best bid），因为偏移量是加上的。

### Passive Relative 与 Relative/Pegged-to-Primary 订单的对比
- **相同点**：都是基于市场最优价格自动调整的限价单。
- **不同点**：Passive Relative 订单从买价中减去偏移量，而Relative/Pegged-to-Primary订单则将偏移量加到买价上。

Passive Relative 订单特别适合那些希望保持价格竞争力，同时又不愿过分激进地参与市场波动的投资者。通过适当的偏移量设置，这种订单类型可以帮助投资者以更有利的价格成交，同时降低因市场波动过大而带来的风险。

# "Snap to Market"（SNAP MKT）订单
是一种特殊类型的订单，它在创建时根据当前的买价（bid）或卖价（ask）加上或减去一个偏移量来确定初始订单价格。这种订单类型与挂钩订单（pegged order）类似，但有一个关键的不同：Snap to Market订单的价格在确定之后不会随市场价格波动而继续调整。

### 订单的工作机制
- **买单（Buy Order）**：订单价格由当前的卖价（ask）减去偏移量来确定。
- **卖单（Sell Order）**：订单价格由当前的买价（bid）加上偏移量来确定。

### 与普通限价单的比较
Snap to Market订单在创建时，其价格是基于市场当前的买卖价格加减偏移量确定的。这个价格在设定后变成一个固定的限价，不会随市场价格变动而改变。因此，可以说Snap to Market订单在确定价格后实际上是一个限价单（limit order）。

### 适用场景
- 当交易者希望在市场价格的基础上立即抓住一个不那么激进的价格点进行交易时，可以使用Snap to Market订单。
- 适用于那些希望一次性设定价格，并不想随后随市场价格变动的情况。

### 总结
Snap to Market订单在创建时，通过考虑市场的即时买卖价格和一个偏移量来设定一个固定的交易价格。与持续挂钩市场价格的订单不同，Snap to Market的价格一旦设定，就不再随市场变动。这种类型的订单特别适合于希望立即锁定价格，同时又希望略微偏离当前市场价格的交易者。